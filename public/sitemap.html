<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mapa del sitio — Aplicación de Liderazgo</title>
    <style>
      :root {
        --blue-700: #0d47a1;
        --blue-500: #1976d2;
        --text: #263238;
        --muted: #546e7a;
        --card: #ffffff;
        --bg: #f7fbff;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial;
        margin: 0;
        color: var(--text);
        background: linear-gradient(180deg, #ffffff 0%, var(--bg) 100%);
        -webkit-font-smoothing: antialiased;
      }
      .wrap {
        max-width: 1100px;
        margin: 28px auto;
        padding: 20px;
      }
      header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 18px;
      }
      .brand {
        display: flex;
        flex-direction: column;
      }
      h1 {
        margin: 0;
        font-size: 1.6rem;
        color: var(--blue-700);
      }
      p.lead {
        margin: 4px 0 0;
        color: var(--muted);
      }

      /* search */
      .controls {
        display: flex;
        gap: 12px;
        align-items: center;
        margin: 18px 0;
      }
      .search {
        flex: 1;
        display: flex;
      }
      input[type='search'] {
        flex: 1;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #e3eefc;
        background: #fff;
        box-shadow: 0 2px 6px rgba(15, 76, 129, 0.04);
      }

      /* grid */
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 14px;
      }
      .card {
        background: var(--card);
        border-radius: 10px;
        padding: 14px;
        border: 1px solid #e9f4ff;
        box-shadow: 0 6px 18px rgba(15, 76, 129, 0.04);
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .card .title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        color: var(--blue-700);
      }
      .card .meta {
        color: var(--muted);
        font-size: 0.9rem;
      }
      .card a {
        color: var(--blue-500);
        text-decoration: none;
      }
      .small {
        font-size: 0.85rem;
        color: var(--muted);
      }

      footer {
        margin-top: 22px;
        color: var(--muted);
        font-size: 0.9rem;
      }

      /* icons */
      .icon {
        width: 36px;
        height: 36px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        background: linear-gradient(135deg, var(--blue-500), var(--blue-700));
        color: #fff;
      }

      @media (max-width: 520px) {
        .wrap {
          padding: 12px;
        }
        h1 {
          font-size: 1.2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap" role="main">
      <header>
        <div class="icon" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L2 7l10 5 10-5-10-5zm0 7.5L3.5 7 12 3.5 20.5 7 12 9.5zM2 17l10 5 10-5v-3l-10 5-10-5v3z" fill="currentColor" />
          </svg>
        </div>
        <div class="brand">
          <h1>Mapa del sitio</h1>
          <p class="lead">Explora las principales secciones de la aplicación. Usa la búsqueda para filtrar resultados.</p>
        </div>
      </header>

      <div class="controls">
        <div class="search" role="search" aria-label="Buscar en el mapa del sitio">
          <input id="q" type="search" placeholder="Buscar sección o ruta (ej. proyectos, equipos)" />
        </div>
        <div class="actions">
          <button id="refresh" title="Actualizar desde sitemap.xml">Actualizar</button>
        </div>
      </div>

      <section aria-live="polite">
        <div id="grid" class="grid" aria-label="Listado de rutas"></div>
      </section>

      <footer>
        <div id="status" class="small">Cargando sitemap...</div>
        <div class="small">
          Nota: las rutas dinámicas se listan en forma genérica. Visita la sección correspondiente para ver elementos con identificador.
        </div>
      </footer>
    </div>

    <script>
      const grid = document.getElementById('grid');
      const status = document.getElementById('status');
      const q = document.getElementById('q');
      const refresh = document.getElementById('refresh');

      // Render item card
      function renderItem({ loc, lastmod, priority }) {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
                  <div class="title">
                    <div style="width:40px;height:40px;border-radius:8px;background:#eef7ff;display:flex;align-items:center;justify-content:center;color:var(--blue-700);font-weight:700">${getShortIcon(
                      loc
                    )}</div>
                    <div style="flex:1">
                      <div><a href="${loc}">${trimLoc(loc)}</a></div>
                      <div class="meta">${new Date(lastmod || Date.now()).toLocaleDateString('es-ES')} · prioridad ${priority || '—'}</div>
                    </div>
                  </div>
                `;
        return card;
      }

      function trimLoc(loc) {
        try {
          const u = new URL(loc, location.origin);
          return u.pathname === '/' ? '/' : u.pathname.replace(/\/$/, '');
        } catch (e) {
          return loc;
        }
      }

      function getShortIcon(loc) {
        // simple initial extractor
        try {
          const u = new URL(loc, location.origin);
          const parts = u.pathname.split('/').filter(Boolean);
          const key = parts[0] || '/';
          return key.charAt(0).toUpperCase();
        } catch (e) {
          return '•';
        }
      }

      // fetch and parse sitemap.xml
      async function loadSitemap() {
        grid.innerHTML = '';
        status.textContent = 'Cargando sitemap...';
        try {
          const res = await fetch('/sitemap.xml', { cache: 'no-store' });
          if (!res.ok) throw new Error('No se pudo obtener sitemap.xml');
          const text = await res.text();
          const parser = new DOMParser();
          const xml = parser.parseFromString(text, 'application/xml');
          const urls = Array.from(xml.getElementsByTagName('url'));
          if (urls.length === 0) {
            status.textContent = 'El sitemap está vacío o no tiene elementos <url>.';
            return;
          }
          const items = urls.map(u => ({
            loc: (u.getElementsByTagName('loc')[0] || {}).textContent || '',
            lastmod: (u.getElementsByTagName('lastmod')[0] || {}).textContent || '',
            priority: (u.getElementsByTagName('priority')[0] || {}).textContent || '',
          }));
          // render
          items.forEach(it => grid.appendChild(renderItem(it)));
          status.textContent = `Mostrando ${items.length} rutas desde sitemap.xml`;
        } catch (err) {
          status.textContent = 'No se pudo cargar sitemap.xml — mostrando enlaces estáticos.';
          // fallback static links (mirar rutas comunes)
          const staticLinks = [
            '/',
            '/login',
            '/dashboard',
            '/reports',
            '/projects',
            '/evaluations',
            '/questionnaires',
            '/teams',
            '/guides',
          ];
          staticLinks.forEach(s => grid.appendChild(renderItem({ loc: s, lastmod: new Date().toISOString(), priority: '' })));
        }
      }

      // search filter
      q.addEventListener('input', () => {
        const term = q.value.trim().toLowerCase();
        Array.from(grid.children).forEach(card => {
          const text = card.textContent.toLowerCase();
          card.style.display = term === '' || text.includes(term) ? '' : 'none';
        });
      });

      refresh.addEventListener('click', () => loadSitemap());

      // initial load
      loadSitemap();
    </script>
  </body>
</html>
